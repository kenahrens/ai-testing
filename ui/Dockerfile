################################################################################
# BUILDER IMAGE
################################################################################
FROM node:20-buster-slim as builder

# ------------------------------------------------------------------------------
# Define and create working directory
# ------------------------------------------------------------------------------
ENV APP_HOME=/app
RUN mkdir -p ${APP_HOME}
WORKDIR ${APP_HOME}

COPY . .
RUN npm install
RUN npm run build
RUN ls -al

################################################################################
# RELEASE IMAGE
################################################################################

FROM nginx:1.25.1

# ------------------------------------------------------------------------------
# Define and create working directory
# ------------------------------------------------------------------------------
ENV APP_HOME=/app
RUN mkdir -p ${APP_HOME}
WORKDIR ${APP_HOME}

# ------------------------------------------------------------------------------
# Copy built code
# ------------------------------------------------------------------------------
COPY nginx-default.conf /etc/nginx/conf.d/default.conf
COPY --from=builder /app/dist /usr/share/nginx/html
